<%# Tuple ECH Worker Status Template -%>

    <script type="text/javascript">
        //<![CDATA[
        function updateStatus() {
            XHR.get('<%=luci.dispatcher.build_url("admin", "services", "ech-workers", "status")%>', null,
                function (x, data) {
                    var running = data && data.running;
                    var tproxy_active = data && data.tproxy_active;

                    var badge = document.getElementById('ech_status_badge');
                    var text = document.getElementById('ech_status_text');

                    if (running) {
                        badge.className = 'badge success';
                        text.innerHTML = '<%:运行中%>';
                    } else {
                        badge.className = 'badge warning';
                        text.innerHTML = '<%:已停止%>';
                    }

                    // 透明代理状态
                    var tproxyBadge = document.getElementById('tproxy_status_badge');
                    var tproxyText = document.getElementById('tproxy_status_text');

                    if (tproxyBadge && tproxyText) {
                        if (running && tproxy_active) {
                            tproxyBadge.className = 'badge success';
                            tproxyText.innerHTML = '<%:运行中%>';
                        } else if (running) {
                            tproxyBadge.className = 'badge warning';
                            tproxyText.innerHTML = '<%:规则未加载%>';
                        } else {
                            tproxyBadge.className = 'badge warning';
                            tproxyText.innerHTML = '<%:未启用%>';
                        }
                    }
                }
            );
        }

        document.addEventListener('DOMContentLoaded', function () {
            updateStatus();
            setInterval(updateStatus, 5000);
        });
        //]]>
    </script>

    <style>
        .ech-status-box {
            margin-bottom: 1em;
            padding: 1em;
            background: #f7f7f7;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .badge {
            display: inline-block;
            padding: 0.3em 0.8em;
            border-radius: 3px;
            font-weight: bold;
        }

        .badge.success {
            background: #5cb85c;
            color: white;
        }

        .badge.warning {
            background: #f0ad4e;
            color: white;
        }

        .status-row {
            margin-bottom: 0.5em;
        }

        .status-row:last-child {
            margin-bottom: 0;
        }
    </style>

    <div class="ech-status-box">
        <div class="status-row">
            <strong>
                <%:ECH Workers%>:
            </strong>
            <span id="ech_status_badge" class="badge warning">
                <span id="ech_status_text">
                    <%:检测中...%>
                </span>
            </span>
        </div>
        <div class="status-row">
            <strong>
                <%:透明代理%>:
            </strong>
            <span id="tproxy_status_badge" class="badge warning">
                <span id="tproxy_status_text">
                    <%:检测中...%>
                </span>
            </span>
        </div>
    </div>